# StacksOS Environment Configuration
# Copy this file to .env.local and configure for your environment

# ============================================================================
# Evergreen ILS Connection
# ============================================================================

# Base URL for Evergreen OpenSRF gateway (HTTPS recommended)
EVERGREEN_BASE_URL=https://your-evergreen-server.org

# SSL Certificate Verification
# SECURITY WARNING: Only disable for development with self-signed certificates
# In production, install proper SSL certificates instead
# If using an internal CA / self-signed certificate, prefer adding the CA:
# NODE_EXTRA_CA_CERTS=/path/to/evergreen-ca.crt
# NODE_TLS_REJECT_UNAUTHORIZED=0

# ============================================================================
# Evergreen Database Connection (Direct PostgreSQL)
# Recommended: use a dedicated low-privilege role (not the Evergreen DB owner).
# ============================================================================

EVERGREEN_DB_HOST=your-db-host
EVERGREEN_DB_PORT=5432
EVERGREEN_DB_NAME=evergreen
EVERGREEN_DB_USER=stacksos_app
EVERGREEN_DB_PASSWORD=your-secure-password-here

# ============================================================================
# StacksOS Configuration
# ============================================================================

# Base URL for StacksOS (used in email notifications, etc.)
STACKSOS_BASE_URL=https://catalog.yourlibrary.org

# ============================================================================
# UI Environment Banner (Polaris-style)
# ============================================================================
# Optional: show an environment banner in the top header for easy visual distinction.
# Examples:
#   STACKSOS_ENV_LABEL=PRODUCTION
#   STACKSOS_ENV_TONE=prod
#
# Tones: prod | training | sandbox | dev
# STACKSOS_ENV_LABEL=
# STACKSOS_ENV_TONE=

# RBAC Mode: strict (enforce permissions), warn (log violations), off (disabled)
STACKSOS_RBAC_MODE=strict

# Cookie Security (set to true in production with HTTPS)
STACKSOS_COOKIE_SECURE=true

# Staff idle timeout (minutes). Set empty to disable.
# Example: STACKSOS_IDLE_TIMEOUT_MINUTES=480
# STACKSOS_IDLE_TIMEOUT_MINUTES=

# Self-checkout session TTL (minutes). Default: 30.
# Rationale: self-checkout devices are often shared terminals; keep sessions short.
# Allowed range: 5..480.
# STACKSOS_SELF_CHECKOUT_SESSION_MINUTES=30

# Optional: restrict access to staff/admin/api routes by IP/CIDR (comma-separated).
# Examples:
#   STACKSOS_IP_ALLOWLIST=192.168.1.0/24
#   STACKSOS_IP_ALLOWLIST=192.168.1.0/24,203.0.113.10
# STACKSOS_IP_ALLOWLIST=

# OpenSRF Gateway Timeout (milliseconds)
STACKSOS_EVERGREEN_TIMEOUT_MS=15000

# Email Notification Configuration
# ============================================================================

# Email Provider
# Options: console (dev only - logs to console), resend, sendgrid, ses
STACKSOS_EMAIL_PROVIDER=console

# Provider-specific API Keys
# For Resend: Get from https://resend.com/api-keys
# For SendGrid: Get from https://app.sendgrid.com/settings/api_keys  
# For AWS SES: Use AWS access key
# STACKSOS_EMAIL_API_KEY=re_xxxxxxxxxxxxxxxxxxxx

# Default From Address (used if library-specific email not set)
STACKSOS_EMAIL_FROM=noreply@yourlibrary.org
STACKSOS_EMAIL_FROM_NAME=Your Library Name

# AWS SES Configuration (only if using SES provider)
# STACKSOS_EMAIL_REGION=us-east-1

# Dry Run Mode - set to true to log emails without actually sending them
# Useful for testing email templates and logic without sending real emails
STACKSOS_EMAIL_DRY_RUN=true

# ============================================================================
# Email Provider Setup Examples
# ============================================================================
#
# RESEND (Recommended for ease of use):
#   STACKSOS_EMAIL_PROVIDER=resend
#   STACKSOS_EMAIL_API_KEY=re_xxxxxxxxxxxxxxxxxxxx
#   STACKSOS_EMAIL_FROM=noreply@yourlibrary.org
#   STACKSOS_EMAIL_DRY_RUN=false
#
# SENDGRID:
#   STACKSOS_EMAIL_PROVIDER=sendgrid
#   STACKSOS_EMAIL_API_KEY=SG.xxxxxxxxxxxxxxxxxxxx
#   STACKSOS_EMAIL_FROM=noreply@yourlibrary.org
#   STACKSOS_EMAIL_DRY_RUN=false
#
# AMAZON SES:
#   STACKSOS_EMAIL_PROVIDER=ses
#   STACKSOS_EMAIL_API_KEY=AKIAXXXXXXXXXXXX
#   STACKSOS_EMAIL_REGION=us-east-1
#   STACKSOS_EMAIL_FROM=noreply@yourlibrary.org
#   STACKSOS_EMAIL_DRY_RUN=false
#
# DEVELOPMENT (Console logging only):
#   STACKSOS_EMAIL_PROVIDER=console
#   STACKSOS_EMAIL_DRY_RUN=true
#
# ============================================================================
# Security & Performance
# ============================================================================

# Shared Redis (recommended for multi-instance deployments)
# Enables distributed rate limiting and idempotency storage.
# Example: redis://localhost:6379
# STACKSOS_REDIS_URL=
# Optional prefix to namespace keys per environment/tenant.
# STACKSOS_REDIS_PREFIX=stacksos

# CSP hardening (optional, recommended for production rollout)
# When enabled, middleware emits a stricter CSP in REPORT-ONLY mode and
# collects violations at /api/security/csp-report. Baseline CSP remains unchanged.
# STACKSOS_CSP_REPORT_ONLY=false

# Node Environment
NODE_ENV=production

# Session Secret (generate with: openssl rand -base64 32)
# SESSION_SECRET=your-random-secret-here

# ============================================================================
# Optional Features
# ============================================================================

# ============================================================================
# ILL (Interlibrary Loan) Provider Sync (Optional)
# ============================================================================
#
# StacksOS supports ILL request tracking in "manual" mode out of the box.
# If you want to sync new ILL requests to an external system, configure:
#
# Providers:
#   manual | illiad | tipasa | reshare | custom-webhook
#
# Sync modes:
#   manual  - never attempt API sync (local tracking only)
#   monitor - mark requests as queued, but do not POST anywhere (safe for pilots)
#   enabled - POST new requests to STACKSOS_ILL_API_URL
#
# STACKSOS_ILL_PROVIDER=manual
# STACKSOS_ILL_SYNC_MODE=manual
#
# Endpoint (required for non-manual providers):
# STACKSOS_ILL_API_URL=https://ill-provider.example.org/webhook
#
# Auth (for non-custom-webhook providers):
# STACKSOS_ILL_API_KEY=
# STACKSOS_ILL_USERNAME=
# STACKSOS_ILL_PASSWORD=
#
# Request timeout (ms). Default: 10000
# STACKSOS_ILL_TIMEOUT_MS=10000

# Enable/disable specific features
# STACKSOS_FEATURE_OFFLINE_MODE=true
# STACKSOS_FEATURE_SELF_CHECKOUT=true
# STACKSOS_FEATURE_PATRON_MESSAGING=false

# Experimental bundle toggle (0/1). Enables OPAC v2, Kids, AI, policy editors, etc.
# NOTE: This value is exposed to the browser (NEXT_PUBLIC_ prefix).
# NEXT_PUBLIC_STACKSOS_EXPERIMENTAL=0

# Logging Level: debug, info, warn, error
# STACKSOS_LOG_LEVEL=info

# ============================================================================
# Development Only
# ============================================================================

# Bundle Analyzer (set to true to generate bundle analysis)
# ANALYZE=false

# Verbose Logging
# STACKSOS_DEBUG=false
