# StacksOS Environment Configuration
# Copy this file to .env.local and configure for your environment

# ============================================================================
# Evergreen ILS Connection
# ============================================================================

# Base URL for Evergreen OpenSRF gateway (HTTPS recommended)
EVERGREEN_BASE_URL=https://your-evergreen-server.org

# SSL Certificate Verification
# SECURITY WARNING: Only disable for development with self-signed certificates
# In production, install proper SSL certificates instead
# If using an internal CA / self-signed certificate, prefer adding the CA:
# NODE_EXTRA_CA_CERTS=/path/to/evergreen-ca.crt
# NODE_TLS_REJECT_UNAUTHORIZED=0

# ============================================================================
# Evergreen Database Connection (Direct PostgreSQL)
# Recommended: use a dedicated low-privilege role (not the Evergreen DB owner).
# ============================================================================

EVERGREEN_DB_HOST=your-db-host
EVERGREEN_DB_PORT=5432
EVERGREEN_DB_NAME=evergreen
EVERGREEN_DB_USER=stacksos_app
EVERGREEN_DB_PASSWORD=your-secure-password-here

# Optional: mirror patron photo URL writes into Evergreen core table actor.usr.photo_url.
# Default behavior keeps photo writes in StacksOS-owned library.* tables only.
# STACKSOS_SYNC_PATRON_PHOTO_TO_EVERGREEN=0

# ============================================================================
# StacksOS Configuration
# ============================================================================

# Base URL for StacksOS (used in email notifications, etc.)
STACKSOS_BASE_URL=https://catalog.yourlibrary.org

# Multi-tenant / profile settings (SaaS and multi-library pilots)
STACKSOS_TENANT_ID=default
STACKSOS_TENANT_DISPLAY_NAME=Your Library
# Profiles: public | school | church | academic | custom
STACKSOS_TENANT_PROFILE=public
# Optional client-side profile hint for navigation/UX bundles
# NEXT_PUBLIC_STACKSOS_TENANT_PROFILE=public
# Optional region label: us-east, us-west, etc.
# STACKSOS_TENANT_REGION=
# Optional profile notes for admins
# STACKSOS_TENANT_PROFILE_NOTES=

# Discovery defaults (tenant-level OPAC scope behavior)
# local       = default to patron's selected branch
# system      = default to branch parent system
# consortium  = default to full consortium
# STACKSOS_DISCOVERY_SCOPE=local
# Evergreen-style depth from selected scope org:
#   0 = selected org only
#   1 = include one descendant level
#   99 = include all descendants
# STACKSOS_DISCOVERY_COPY_DEPTH=1
# Allow patrons to change search scope/depth in OPAC UI
# STACKSOS_DISCOVERY_ALLOW_SCOPE_OVERRIDE=true

# ============================================================================
# UI Environment Banner (Polaris-style)
# ============================================================================
# Optional: show an environment banner in the top header for easy visual distinction.
# Examples:
#   STACKSOS_ENV_LABEL=PRODUCTION
#   STACKSOS_ENV_TONE=prod
#
# Tones: prod | training | sandbox | dev
# STACKSOS_ENV_LABEL=
# STACKSOS_ENV_TONE=

# RBAC Mode: strict (enforce permissions), warn (log violations), off (disabled)
STACKSOS_RBAC_MODE=strict

# Optional SaaS platform-admin bootstrap list (comma-separated usernames and/or IDs).
# Examples:
#   STACKSOS_SAAS_PLATFORM_ADMINS=jake
#   STACKSOS_SAAS_PLATFORM_ADMINS=jake,id:1001
# This grants platform-admin session access without requiring a DB role row.
# STACKSOS_SAAS_PLATFORM_ADMINS=

# Cookie Security (set to true in production with HTTPS)
STACKSOS_COOKIE_SECURE=true

# Staff idle timeout (minutes). Set empty to disable.
# Example: STACKSOS_IDLE_TIMEOUT_MINUTES=480
# STACKSOS_IDLE_TIMEOUT_MINUTES=

# Self-checkout session TTL (minutes). Default: 30.
# Rationale: self-checkout devices are often shared terminals; keep sessions short.
# Allowed range: 5..480.
# STACKSOS_SELF_CHECKOUT_SESSION_MINUTES=30

# Optional: restrict access to staff/admin/api routes by IP/CIDR (comma-separated).
# Examples:
#   STACKSOS_IP_ALLOWLIST=192.168.1.0/24
#   STACKSOS_IP_ALLOWLIST=192.168.1.0/24,203.0.113.10
# STACKSOS_IP_ALLOWLIST=

# OpenSRF Gateway Timeout (milliseconds)
STACKSOS_EVERGREEN_TIMEOUT_MS=15000

# Email Notification Configuration
# ============================================================================

# Email Provider
# Options: console (dev only - logs to console), resend, sendgrid, ses
STACKSOS_EMAIL_PROVIDER=console

# Provider-specific API Keys
# For Resend: Get from https://resend.com/api-keys
# For SendGrid: Get from https://app.sendgrid.com/settings/api_keys  
# For AWS SES: Use AWS access key
# STACKSOS_EMAIL_API_KEY=re_xxxxxxxxxxxxxxxxxxxx

# Default From Address (used if library-specific email not set)
STACKSOS_EMAIL_FROM=noreply@yourlibrary.org
STACKSOS_EMAIL_FROM_NAME="Your Library Name"

# AWS SES Configuration (only if using SES provider)
# STACKSOS_EMAIL_REGION=us-east-1

# Dry Run Mode - set to true to log emails without actually sending them
# Useful for testing email templates and logic without sending real emails
STACKSOS_EMAIL_DRY_RUN=true

# ============================================================================
# Email Provider Setup Examples
# ============================================================================
#
# RESEND (Recommended for ease of use):
#   STACKSOS_EMAIL_PROVIDER=resend
#   STACKSOS_EMAIL_API_KEY=re_xxxxxxxxxxxxxxxxxxxx
#   STACKSOS_EMAIL_FROM=noreply@yourlibrary.org
#   STACKSOS_EMAIL_DRY_RUN=false
#
# SENDGRID:
#   STACKSOS_EMAIL_PROVIDER=sendgrid
#   STACKSOS_EMAIL_API_KEY=SG.xxxxxxxxxxxxxxxxxxxx
#   STACKSOS_EMAIL_FROM=noreply@yourlibrary.org
#   STACKSOS_EMAIL_DRY_RUN=false
#
# AMAZON SES:
#   STACKSOS_EMAIL_PROVIDER=ses
#   STACKSOS_EMAIL_API_KEY=AKIAXXXXXXXXXXXX
#   STACKSOS_EMAIL_REGION=us-east-1
#   STACKSOS_EMAIL_FROM=noreply@yourlibrary.org
#   STACKSOS_EMAIL_DRY_RUN=false
#
# DEVELOPMENT (Console logging only):
#   STACKSOS_EMAIL_PROVIDER=console
#   STACKSOS_EMAIL_DRY_RUN=true
#
# ============================================================================
# Security & Performance
# ============================================================================

# Shared Redis (recommended for multi-instance deployments)
# Enables distributed rate limiting and idempotency storage.
# Example: redis://localhost:6379
# STACKSOS_REDIS_URL=
# Optional prefix to namespace keys per environment/tenant.
# STACKSOS_REDIS_PREFIX=stacksos

# CSP hardening (optional, recommended for production rollout)
# When enabled, middleware emits a stricter CSP in REPORT-ONLY mode and
# collects violations at /api/security/csp-report. Baseline CSP remains unchanged.
# STACKSOS_CSP_REPORT_ONLY=false

# Node Environment
NODE_ENV=production

# Session Secret (generate with: openssl rand -base64 32)
# SESSION_SECRET=your-random-secret-here

# ============================================================================
# Optional Features
# ============================================================================

# ============================================================================
# ILL (Interlibrary Loan) Provider Sync (Optional)
# ============================================================================
#
# StacksOS supports ILL request tracking in "manual" mode out of the box.
# If you want to sync new ILL requests to an external system, configure:
#
# Providers:
#   manual | illiad | tipasa | reshare | custom-webhook
#
# Sync modes:
#   manual  - never attempt API sync (local tracking only)
#   monitor - mark requests as queued, but do not POST anywhere (safe for pilots)
#   enabled - POST new requests to STACKSOS_ILL_API_URL
#
# STACKSOS_ILL_PROVIDER=manual
# STACKSOS_ILL_SYNC_MODE=manual
#
# Endpoint (required for non-manual providers):
# STACKSOS_ILL_API_URL=https://ill-provider.example.org/webhook
#
# Auth (for non-custom-webhook providers):
# STACKSOS_ILL_API_KEY=
# STACKSOS_ILL_USERNAME=
# STACKSOS_ILL_PASSWORD=
#
# Request timeout (ms). Default: 10000
# STACKSOS_ILL_TIMEOUT_MS=10000

# Enable/disable specific features
# STACKSOS_FEATURE_OFFLINE_MODE=true
# STACKSOS_FEATURE_SELF_CHECKOUT=true
# STACKSOS_FEATURE_PATRON_MESSAGING=false

# Experimental bundle toggle (0/1). Enables OPAC v2, Kids, AI, policy editors, etc.
# NOTE: This value is exposed to the browser (NEXT_PUBLIC_ prefix).
# NEXT_PUBLIC_STACKSOS_EXPERIMENTAL=0

# Sandbox-only demo controls (default disabled)
# Enable only for disposable environments.
# STACKSOS_ALLOW_DEMO_DATA=0
# STACKSOS_ALLOW_MOCK_EVENTS=0
# Production runtime hard-disables demo/mock data regardless of these flags.

# Logging Level: debug, info, warn, error
# STACKSOS_LOG_LEVEL=info

# ============================================================================
# Development Only
# ============================================================================

# Bundle Analyzer (set to true to generate bundle analysis)
# ANALYZE=false

# Verbose Logging
# STACKSOS_DEBUG=false

# ==========================================================================
# AI Runtime Controls
# ==========================================================================
# Enable AI runtime (0/1)
# STACKSOS_AI_ENABLED=1

# Provider: openai | anthropic | moonshot
# For Kimi 2.5 Pro (Moonshot), use:
# STACKSOS_AI_PROVIDER=moonshot
# STACKSOS_AI_MODEL=moonshotai/kimi-k2.5
# Optional comma-separated model fallbacks (tried before deterministic fallback).
# If unset and primary is kimi-k2.5, StacksOS auto-tries moonshotai/kimi-k2-instruct.
# STACKSOS_AI_MODEL_FALLBACKS=moonshotai/kimi-k2-instruct

# Moonshot/NVIDIA credentials
# MOONSHOT_API_KEY=replace-with-your-key
# MOONSHOT_API_BASE_URL=https://integrate.api.nvidia.com/v1

# AI provider request timeout in milliseconds (1000..60000)
# STACKSOS_AI_TIMEOUT_MS=10000
# Retry controls (reduce fallback during transient provider latency)
# Attempts include the initial call. Default is 2.
# STACKSOS_AI_RETRY_ATTEMPTS=2
# Exponential backoff base delay in ms between retries.
# STACKSOS_AI_RETRY_BACKOFF_MS=400
# Optional retry timeout override in ms. If unset, StacksOS uses call-type defaults.
# STACKSOS_AI_RETRY_TIMEOUT_MS=22000
# Copilot/ops-only timeout override in ms.
# STACKSOS_AI_COPILOT_TIMEOUT_MS=16000
# Copilot/ops-only retry attempts. Defaults to 3 for copilot calls.
# STACKSOS_AI_COPILOT_RETRY_ATTEMPTS=3
# Copilot/ops-only retry timeout override in ms.
# STACKSOS_AI_COPILOT_RETRY_TIMEOUT_MS=42000
# Attempts per fallback model before deterministic fallback.
# STACKSOS_AI_FALLBACK_MODEL_ATTEMPTS=1

# ==========================================================================
# Evergreen TLS Trust (recommended in production)
# ==========================================================================
# Preferred CA bundle path for Evergreen TLS trust
# STACKSOS_EVERGREEN_CA_FILE=/usr/local/share/ca-certificates/evergreen-<host>.crt

# ==========================================================================
# AI Providers
# ==========================================================================
# OPENAI_API_KEY=
# OPENAI_API_BASE_URL=
# ANTHROPIC_API_KEY=
# ANTHROPIC_API_BASE_URL=
# ANTHROPIC_VERSION=

# ==========================================================================
# AI Budget & Tuning
# ==========================================================================
# STACKSOS_AI_MAX_TOKENS=2048
# STACKSOS_AI_TEMPERATURE=0.3
# STACKSOS_AI_SAFETY_MODE=strict
# STACKSOS_AI_BUDGET_CALLS_PER_HOUR=100
# STACKSOS_AI_BUDGET_USD_PER_DAY=10

# ==========================================================================
# SMTP Email (alternative to Resend/SendGrid/SES)
# ==========================================================================
# STACKSOS_SMTP_HOST=
# STACKSOS_SMTP_PORT=587
# STACKSOS_SMTP_SECURE=true
# STACKSOS_SMTP_USER=
# STACKSOS_SMTP_PASS=

# ==========================================================================
# SMS
# ==========================================================================
# STACKSOS_SMS_PROVIDER=twilio
# STACKSOS_SMS_DRY_RUN=true
# STACKSOS_SMS_WEBHOOK_URL=

# ==========================================================================
# eContent Providers
# ==========================================================================
# OVERDRIVE_LIBRARY_URL=
# HOOPLA_LIBRARY_URL=
# CLOUDLIBRARY_URL=
# KANOPY_LIBRARY_URL=

# ==========================================================================
# Branding
# ==========================================================================
# STACKSOS_BRANDING_PRIMARY_COLOR=#2563eb
# STACKSOS_BRANDING_LOGO_URL=

# ==========================================================================
# Security
# ==========================================================================
# STACKSOS_MFA_REQUIRED=false
# STACKSOS_MFA_ISSUER=StacksOS
# STACKSOS_METRICS_SECRET=
# STACKSOS_SCHEDULED_REPORTS_SECRET=
# STACKSOS_DEBUG_ERRORS=false
# STACKSOS_E2E_TEST_MODE=false
# STACKSOS_CSP_REPORT_ONLY=true

# ==========================================================================
# Patron Barcodes
# ==========================================================================
# STACKSOS_PATRON_BARCODE_MODE=auto
# STACKSOS_PATRON_BARCODE_PREFIX=

# ==========================================================================
# Audit
# ==========================================================================
# STACKSOS_AUDIT_LOG_PATH=
# STACKSOS_AUDIT_MODE=db

# ==========================================================================
# Public URLs
# ==========================================================================
# STACKSOS_PUBLIC_BASE_URL=http://localhost:3000
# NEXT_PUBLIC_BASE_URL=http://localhost:3000
# NEXT_PUBLIC_STACKSOS_COVER_PROVIDER_ORDER=google,openlibrary

# ==========================================================================
# Cron & Internal
# ==========================================================================
# CRON_SECRET=
# EVERGREEN_IDL_PATH=
